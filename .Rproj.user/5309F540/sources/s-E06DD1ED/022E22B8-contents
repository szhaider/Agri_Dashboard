library(tidyverse)
library(sf)
library(haven)

rm(list=ls())

#Reading in dataset of all crops

data <-  read_dta("final_output_LUMS_Paper_1_updated.dta")%>% 
  select(year, province = province_data4pakistan, district = district_data4pakistan, crop, production_tonnes) %>% 
  arrange(year, district)  %>% 
  filter(district != "") %>% 
  pivot_wider(-province, names_from = district, values_from = production_tonnes) %>% 
  mutate(Awaran= NA,
         'Bajaur Agency' = NA,
         Barkhan = NA,
         Chiniot = NA,
         'FR Bannu' = NA,
         'FR Dera Ismail Khan' = NA,
         'FR Kohat' = NA,
         'FR Lakki Marwat' = NA,
         'FR Peshawar' = NA,
         'FR Tank'  = NA,
         Ghotki = NA,
         Gwadar = NA,
         Hangu = NA,
         Harnai = NA,
         Islamabad = NA,
         Jamshoro = NA,
         'Jhal Magsi' = NA,
         Kashmore  = NA,
         'Khyber Agency' = NA,
         'Killa Abdullah' = NA,
         'Kurram Agency' = NA,
         Lehri= NA,
         'Lower Dir'  = NA,
         Mastung = NA,
         Matiari  = NA,
         'Mirpur Khas'  = NA,
         Musakhel = NA,
         'Nankana Sahib'  = NA,
         'North Waziristan Agency' = NA,
         Nushki = NA,
         'Orakzai Agency' = NA,
         'Qambar Shahdadkot' = NA,
         Shangla = NA,
         Sheerani = NA,
         Sohbatpur = NA,
         'South Waziristan Agency' = NA,
         Sujawal = NA,
         'Tando Allah Yar' = NA,
         'Tando Muhammad Khan' = NA,
         'Tor Ghar' = NA,
         Umerkot = NA,
         'Upper Dir' = NA,
         Washuk = NA,
         'Mohmand Agency' = NA) %>%
  # janitor::clean_names() %>% 
  pivot_longer(Abbottabad:'Mohmand Agency',
               names_to = "district" , 
               values_to = "production") %>% 
  mutate(production = production / 1000) %>% 
  arrange(crop, district)



#Reading in Data
# data <- read_dta("District_Agri_Output.dta") %>% 
#   select(year, province = province_data4pakistan, district = district_data4pakistan, crop, production_tonnes) %>% 
#   arrange(year, district) %>% 
#   filter(district != "") %>% #Dropping those which aren't matched (e.g. Dir which is upper dir nd lower dir in daat4pak)
#   # filter(year == 2019) %>%   
#   # filter(crop == "Cotton") %>% View()
#   pivot_wider(-province, names_from = district, values_from = production_tonnes) %>% 
#   mutate(Awaran= NA,
#          'Bajaur Agency' = NA,
#          Barkhan = NA,
#          Chiniot = NA,
#          'FR Bannu' = NA,
#          'FR Dera Ismail Khan' = NA,
#         'FR Kohat' = NA,
#         'FR Lakki Marwat' = NA,
#         'FR Peshawar' = NA,
#         'FR Tank'  = NA,
#         Ghotki = NA,
#         Gwadar = NA,
#         Hangu = NA,
#         Harnai = NA,
#         Islamabad = NA,
#         Jamshoro = NA,
#        'Jhal Magsi' = NA,
#        Kashmore  = NA,
#        'Khyber Agency' = NA,
#        'Killa Abdullah' = NA,
#        'Kurram Agency' = NA,
#        Lehri= NA,
#       'Lower Dir'  = NA,
#       Mastung = NA,
#       Matiari  = NA,
#      'Mirpur Khas'  = NA,
#      Musakhel = NA,
#      'Nankana Sahib'  = NA,
#       'North Waziristan Agency' = NA,
#      Nushki = NA,
#       'Orakzai Agency' = NA,
#       'Qambar Shahdadkot' = NA,
#      Shangla = NA,
#      Sheerani = NA,
#      Sohbatpur = NA,
#     'South Waziristan Agency' = NA,
#     Sujawal = NA,
#     'Tando Allah Yar' = NA,
#     'Tando Muhammad Khan' = NA,
#     'Tor Ghar' = NA,
#     Umerkot = NA,
#     'Upper Dir' = NA,
#     Washuk = NA,
#     'Mohmand Agency' = NA) %>%
#     # janitor::clean_names() %>% 
#   pivot_longer(Abbottabad:'Mohmand Agency',
#                names_to = "district" , 
#                values_to = "production") %>% 
#    mutate(production = production / 1000) %>% 
#    arrange(crop, district)

data %>% write_rds("data/data.RDS")
# %>% 
#   filter(crop == "Cotton") %>%
#   distinct(district) %>% arrange(district) %>%  View()


district_data <- unique(data$district)

#Reading in Shape file
pak_shp <- read_sf("shapefile_district/pakistan_indicators.shp") %>% 
  janitor::clean_names() %>% 
  filter(year== 2018) %>% 
  select(province, district, geometry) %>% 
  st_transform(crs= 4326) %>% 
  arrange(district)
  
pak_shp %>% saveRDS("data/pak_shp.RDS")

district_shp <- unique(pak_shp$district) 

pak_shp %>% as_tibble() %>%  distinct(district) %>% View()

is.element(district_shp, district_data)  #all matched
